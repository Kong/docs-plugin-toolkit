{
  "entity_checks": [],
  "fields": [
    {
      "protocols": {
        "required": true,
        "type": "set",
        "elements": {
          "type": "string",
          "one_of": [
            "grpc",
            "grpcs",
            "http",
            "https"
          ]
        },
        "default": [
          "grpc",
          "grpcs",
          "http",
          "https"
        ],
        "description": "A set of strings representing HTTP protocols."
      }
    },
    {
      "consumer": {
        "type": "foreign",
        "reference": "consumers",
        "description": "Custom type for representing a foreign key with a null value allowed.",
        "eq": null
      }
    },
    {
      "consumer_group": {
        "type": "foreign",
        "reference": "consumer_groups",
        "description": "Custom type for representing a foreign key with a null value allowed.",
        "eq": null
      }
    },
    {
      "config": {
        "required": true,
        "type": "record",
        "fields": [
          {
            "content_safety_url": {
              "description": "Full URL, inc protocol, of the Azure Content Safety instance.",
              "required": true,
              "type": "string",
              "referenceable": true
            }
          },
          {
            "azure_api_version": {
              "required": true,
              "type": "string",
              "len_min": 1,
              "default": "2023-10-01",
              "description": "Sets the ?api-version URL parameter, used for defining the Azure Content Services interchange format."
            }
          },
          {
            "azure_use_managed_identity": {
              "type": "boolean",
              "description": "If checked, uses (if set) `azure_client_id`, `azure_client_secret`, and/or `azure_tenant_id` for Azure authentication, via Managed or User-assigned identity",
              "default": false
            }
          },
          {
            "azure_client_id": {
              "required": false,
              "type": "string",
              "description": "If `azure_use_managed_identity` is true, set the client ID if required."
            }
          },
          {
            "azure_client_secret": {
              "required": false,
              "type": "string",
              "description": "If `azure_use_managed_identity` is true, set the client secret if required."
            }
          },
          {
            "azure_tenant_id": {
              "required": false,
              "type": "string",
              "description": "If `azure_use_managed_identity` is true, set the tenant ID if required."
            }
          },
          {
            "content_safety_key": {
              "required": false,
              "description": "If `azure_use_managed_identity` is true, set the API key to call Content Safety.",
              "encrypted": true,
              "type": "string",
              "referenceable": true
            }
          },
          {
            "text_source": {
              "one_of": [
                "concatenate_all_content",
                "concatenate_user_content"
              ],
              "type": "string",
              "description": "Select where to pick the 'text' for the Azure Content Services request.",
              "default": "concatenate_all_content"
            }
          },
          {
            "categories": {
              "type": "array",
              "description": "Array of categories, and their thresholds, to measure on.",
              "elements": {
                "required": true,
                "type": "record",
                "fields": [
                  {
                    "name": {
                      "type": "string",
                      "required": true
                    }
                  },
                  {
                    "rejection_level": {
                      "type": "integer",
                      "required": true
                    }
                  }
                ]
              }
            }
          },
          {
            "reveal_failure_reason": {
              "type": "boolean",
              "description": "Set true to tell the caller why their request was rejected, if so.",
              "default": true
            }
          },
          {
            "output_type": {
              "one_of": [
                "FourSeverityLevels",
                "EightSeverityLevels"
              ],
              "type": "string",
              "description": "See https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/content-filter#content-filtering-categories",
              "default": "FourSeverityLevels"
            }
          },
          {
            "blocklist_names": {
              "type": "array",
              "description": "Use these configured blocklists (in Azure Content Services) when inspecting content.",
              "elements": {
                "type": "string"
              }
            }
          },
          {
            "halt_on_blocklist_hit": {
              "type": "boolean",
              "description": "Tells Azure to reject the request if any blocklist filter is hit.",
              "default": true
            }
          },
          {
            "guarding_mode": {
              "required": true,
              "type": "string",
              "one_of": [
                "INPUT",
                "OUTPUT",
                "BOTH"
              ],
              "default": "INPUT",
              "description": "The guard mode to use for the request"
            }
          },
          {
            "stop_on_error": {
              "type": "boolean",
              "description": "Stop processing if an error occurs",
              "default": true
            }
          },
          {
            "response_buffer_size": {
              "type": "number",
              "required": true,
              "description": "The amount of bytes receiving from upstream to be buffered before sending to the guardrails service. This only applies to the response content guard.",
              "default": 100
            }
          }
        ]
      }
    }
  ]
}